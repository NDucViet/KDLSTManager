<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/reUse.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/fancybox.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/bootstrap-datepicker.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/jquery.timepicker.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/owl.carousel.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../fonts/ionicons/css/ionicons.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../fonts/fontawesome/css/font-awesome.min.css}">

    <link rel="stylesheet" type="text/css" th:href="@{../css/animate.css}">
    <link rel="stylesheet" type="text/css" th:href="@{../css/aos.css}">
    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" th:href="@{../css/style1.css}">

</head>
<style>
    .card-selected {
        background-color: red;
        /* Màu nền được chọn */
    }


    input[type="checkbox"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    input[type="checkbox"] {
        background-color: #ccc;
        border: 1px solid #999;
    }

    input[type="checkbox"]:checked {
        background-color: #64a1e2;
    }

    input[type="checkbox"]:focus {
        outline: 2px solid rgb(96, 248, 142);
    }
</style>

<body>
    <header th:insert="~{Hotel/header1 :: header}"></header>
    <section class="site-hero overlay" style="background-image: url(images/hero_4.jpg)"
        data-stellar-background-ratio="0.5">
        <div class="container">
            <div class="row site-hero-inner justify-content-center align-items-center">
                <div class="col-md-10 text-center" data-aos="fade-up">
                    <span class="custom-caption text-uppercase text-white d-block  mb-3">Welcome To 5 <span
                            class="fa fa-star text-primary"></span> Hotel</span>
                    <h1 class="heading">A Best Place To Stay</h1>
                </div>
            </div>
        </div>

        <a class="mouse smoothscroll" href="#next">
            <div class="mouse-icon">
                <span class="mouse-wheel"></span>
            </div>
        </a>
    </section>
    <!-- END section -->

    <section class="section bg-light pb-0">
        <div class="container">

            <div class="row check-availabilty" id="next">
                <div class="block-32" data-aos="fade-up" data-aos-offset="-200">

                    <form th:action="@{/hotel/getRoom}" th:method="get">
                        <div class="row">
                            <div class="col-md-6 mb-3 mb-lg-0 col-lg-3">
                                <label for="checkin_date" class="font-weight-bold text-black">Check In</label>
                                <div class="field-icon-wrap">
                                    <div class="icon"><span class="icon-calendar"></span></div>
                                    <input type="text" th:value="${startDate}" id="startDate" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3 mb-lg-0 col-lg-3">
                                <label for="checkout_date" class="font-weight-bold text-black">Check Out</label>
                                <div class="field-icon-wrap">
                                    <div class="icon"><span class="icon-calendar"></span></div>
                                    <input type="text" th:value="${endDate}" id="endDate" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3 align-self-end">
                                <button type="submit" class="btn btn-primary btn-block text-white">Check
                                    Availabilty</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <section>
        <div class="container">
            <h2 style="font-weight: lighter;">Our Rooms</h2>
            <p>Perfect creates a brand. Ngu Hanh Hotel Wellcome</p>
            <div class="row" th:each="roomList : ${setRoom}">
                <!-- Sử dụng lặp để tạo cột cho mỗi phòng -->
                <p class="h3" th:text="${roomList.value}" style="display: block;"></p>
                <div class="col-md-2 mb-2" th:each="room : ${roomList.key}">
                    <div class="card h-100 position-relative" style="text-align: center; border: none;">
                        <label th:for="'room_' + ${room.roomID}">
                            <input type="checkbox" th:id="${room.roomID}" onclick="updateTotalPrice()"
                                name="checkBoxNoLabel" th:value="${room.roomType.price}"
                                style="width: 50%; height: 50%;">
                            <input type="hidden" th:id="'price'+${room.roomType.price}" name="onePrice"
                                th:value="${room.roomType.price}">
                            <p th:text="${room.roomID}"></p>
                        </label>
                    </div>
                </div>
            </div>


            <div class="fixed-buttons"
                style="position: sticky; bottom: 0; z-index: 2; background-color: white; padding: 20px; border-top: 1px solid #ccc;">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small text-muted">Tổng giá trị:</span>
                            <span class="lead fw-normal order-total" id="orderTotal">0đ</span>
                            <form th:action="@{/hotel/checkOut}" th:method="post" class="d-inline-block"
                                onsubmit="return toCheckout()">
                                <input type="hidden" name="date" th:value="|${startDate};${endDate}">
                                <input type="hidden" name="bookingRoom" id="bookingRoom">
                                <input type="hidden" name="total" id="total">
                                <button type="submit" class="buttonCheckout" data-mdb-button-init data-mdb-ripple-init
                                    style="border: none; background-color: white; color: orange;" disabled>Book
                                    Room</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>

        function toggleCheckbox(checkbox) {
            var customCheckbox = checkbox.parentElement.querySelector('.custom-checkbox');
            if (checkbox.checked) {
                customCheckbox.classList.add('checked');
            } else {
                customCheckbox.classList.remove('checked');
            }
        }
        function updateTotalPrice() {
            var startDateString = document.getElementById('startDate').value;
            var endDateString = document.getElementById('endDate').value;

            // Phân tích chuỗi ngày thành đối tượng ngày
            var startDate = parseDate(startDateString);
            var endDate = parseDate(endDateString);

            // Tính toán số ngày giữa startDate và endDate
            var oneDay = 24 * 60 * 60 * 1000; // số mili giây trong một ngày
            var diffDays = Math.round(Math.abs((endDate - startDate) / oneDay));

            // Get total price from selected rooms
            var totalPrice = calculateSelectedRoomsTotal();

            // Tính tổng số tiền
            var totalAmount = diffDays * totalPrice;

            // Update the total price on the UI
            var orderTotalElement = document.getElementById('orderTotal');
            orderTotalElement.textContent = formatCurrency(totalAmount);

            //Set value for total price for sent to payment
            var bookingRoomInput = document.getElementById('total');
            bookingRoomInput.value = totalAmount;

            // Enable/disable book button based on totalPrice
            var bookButton = document.querySelector('.buttonCheckout');
            if (totalAmount > 0) {
                bookButton.disabled = false;
            } else {
                bookButton.disabled = true;
            }
        }

        function parseDate(dateString) {
            var parts = dateString.split(/[\s,]+/);
            var day = parseInt(parts[0]);
            var monthIndex = getMonthIndex(parts[1]); // Lấy chỉ số của tháng
            var year = parseInt(parts[2]);
            return new Date(year, monthIndex, day);
        }

        function getMonthIndex(monthName) {
            var months = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            return months.indexOf(monthName);
        }
        function formatCurrency(amount) {
            // Assuming amount is in đồng (VND), format it as needed
            return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        }

        function calculateSelectedRoomsTotal() {
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            var totalPrice = 0;

            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    var price = parseFloat(checkbox.value);
                    totalPrice += price;
                }
            });

            return totalPrice;
        }

        function toCheckout() {
            var bookingRoomInput = document.getElementById("bookingRoom");
            var checkboxes = document.querySelectorAll('input[name="checkBoxNoLabel"]:checked');
            var selectedRooms = [];

            checkboxes.forEach(function (checkbox) {
                selectedRooms.push(checkbox.nextElementSibling.nextElementSibling.textContent);
            });

            bookingRoomInput.value = selectedRooms.join(",");
            return true;
        }
    </script>
    <footer th:insert="~{Hotel/footer1 :: footer}"></footer>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/jquery.timepicker.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/main.js"></script>
    <script th:src="@{/js/Booking.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>

</html>